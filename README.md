<p align="center">
    <a href="https://fingerprint.com">
        <picture>
            <source media="(prefers-color-scheme: dark)" srcset="https://fingerprintjs.github.io/home/resources/logo_light.svg" />
            <source media="(prefers-color-scheme: light)" srcset="https://fingerprintjs.github.io/home/resources/logo_dark.svg" />
            <img src="https://fingerprintjs.github.io/home/resources/logo_dark.svg" alt="Fingerprint logo" width="312px" />
        </picture>
    </a>
</p>
<p align="center">
    <a href="https://github.com/fingerprintjs/dotnet-sdk/actions/workflows/release.yml"><img src="https://github.com/fingerprintjs/dotnet-sdk/actions/workflows/release.yml/badge.svg" alt="CI badge" /></a>
    <a href="https://github.com/fingerprintjs/dotnet-sdk/actions/workflows/tests.yml"><img src="https://github.com/fingerprintjs/dotnet-sdk/actions/workflows/tests.yml/badge.svg" alt="CI badge" /></a>
    <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/:license-mit-blue.svg?style=flat"/></a>
    <a href="https://discord.gg/39EpE2neBg"><img src="https://img.shields.io/discord/852099967190433792?style=logo&label=Discord&logo=Discord&logoColor=white" alt="Discord server"></a>
</p>

# Fingerprint Server API Dotnet SDK

[Fingerprint](https://fingerprint.com) is a device intelligence platform offering industry-leading accuracy.
Fingerprint Server API allows you to search, update, and delete identification events in a server environment. It can be
used for data exports, decision-making, and data analysis scenarios. Server API is intended for server-side usage, it's
not intended to be used from the client side, whether it's a browser or a mobile device.

This C# SDK is automatically generated by the [OpenAPI Generator](https://openapi-generator.tech) project:

- API version: 4
- SDK version: 8.0.0-test.0
- Build package: org.openapitools.codegen.languages.CSharpClientCodegen

<a name="requirements"></a>
## Requirements
- .NET 8.0 or later (we keep the [Microsoft support policy](https://dotnet.microsoft.com/en-us/platform/support/policy/dotnet-core))

<a name="how-to-install"></a>
## How to install

We recommend installing the package from [NuGet](https://docs.nuget.org/consume/installing-nuget):
```shell
dotnet add package Fingerprint.ServerSdk
```

<a name="getting-started"></a>
## Getting Started

```csharp
// Example usage of our SDK

// Import namespaces
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.DependencyInjection;
using Fingerprint.ServerSdk.Api;
using Fingerprint.ServerSdk.Client;
using Fingerprint.ServerSdk.Model;

namespace YourProject
{
    public class Program
    {
        public static async Task Main(string[] args)
        {
            var host = CreateHostBuilder(args).Build();
            var api = host.Services.GetRequiredService<IFingerprintApi>();
            var response = await api.SearchEventsAsync(limit: 2);

            if (response.TryOk(out EventSearch events))
            {
                // Process events...
            }

            // You can also access the raw content and headers:
            // string rawContent = response.RawContent;
            // HttpResponseHeaders headers = response.Headers;
        }

        public static IHostBuilder CreateHostBuilder(string[] args) => Host.CreateDefaultBuilder(args)
          .ConfigureFingerprint((context, services, options) =>
          {
              BearerToken token = new(Environment.GetEnvironmentVariable("SECRET_API_KEY")!);
              options.AddTokens(token);

              // optionally choose the method the tokens will be provided with, default is RateLimitProvider
              options.UseProvider<RateLimitProvider<BearerToken>, BearerToken>();

              options.ConfigureJsonOptions((jsonOptions) =>
              {
                  // your custom converters if any
              });

              options.AddApiHttpClients(client =>
              {
                  // custom client configuration
              }, builder =>
              {
                  builder
                      .AddRetryPolicy(2)
                      .AddTimeoutPolicy(TimeSpan.FromSeconds(5))
                      .AddCircuitBreakerPolicy(10, TimeSpan.FromSeconds(30));
                      // add whatever middleware you prefer
                  }
              );
          });
    }
}
```

You can view more examples in [src/Fingerprint.ServerSdk.Examples/Program.cs](src/Fingerprint.ServerSdk.Examples/Program.cs).

### Handling Responses

The SDK provides type-safe response handling with `IsXxx` properties and extraction methods:

```csharp
var response = await api.GetEventAsync("event_id");

// Check response status
if (response.IsOk)
{
    // Extract successful response
    Event ev = response.Ok();
    Console.WriteLine($"Visitor ID: {event.Identification.VisitorId}");
}
else if (response.IsNotFound)
{
    // Extract error response
    ErrorResponse error = response.NotFound();
    Console.WriteLine($"Error: {error.Error.Message}");
}
else if (response.IsBadRequest)
{
    ErrorResponse error = response.BadRequest();
    Console.WriteLine($"Bad request: {error.Error.Message}");
}
else if (response.IsForbidden)
{
    ErrorResponse error = response.Forbidden();
    Console.WriteLine($"Forbidden: {error.Error.Message}");
}
else if (response.IsTooManyRequests)
{
    ErrorResponse error = response.TooManyRequests();
    Console.WriteLine($"Rate limited. Retry after: {response.Headers.RetryAfter}");
}
```

You can also use the `TryXxx` methods for safe extraction:

```csharp
if (response.TryOk(out Event ev))
{
    Console.WriteLine($"Visitor ID: {ev.Identification.VisitorId}");
}
else if (response.TryNotFound(out ErrorResponse error))
{
    Console.WriteLine($"Not found: {error.Error.Message}");
}
```

### Region

If your subscription is in a region other than the US, you need to change the region when building a host:

```csharp
public static IHostBuilder CreateHostBuilder(string[] args) => Host.CreateDefaultBuilder(args)
    .ConfigureFingerprint((context, services, options) =>
    {
        // ...
        options.SetRegion(Region.EU);
    });
```

## Sealed results

This SDK provides utility methods for decoding [sealed results](https://dev.fingerprint.com/docs/sealed-client-results).
```csharp
using Fingerprint.ServerSdk;

var sealedResult = Environment.GetEnvironmentVariable("BASE64_SEALED_RESULT")!;
var sealedKey = Environment.GetEnvironmentVariable("BASE64_KEY")!;

var event = Sealed.UnsealEventResponse(Convert.FromBase64String(sealedResult), new[]
{
    new Sealed.DecryptionKey(Convert.FromBase64String(sealedKey), Sealed.DecryptionAlgorithm.Aes256Gcm)
});
```

To learn more, refer to example located in [src/Fingerprint.ServerSdk.SealedResultExample/Program.cs](src/Fingerprint.ServerSdk.SealedResultExample/Program.cs).

## Webhook signature validation

This SDK provides utility method for verifying the HMAC signature of the incoming webhook request.

```csharp
namespace FingerprintAspNetCore.Areas.Identity.Pages;

using Fingerprint.ServerSdk;
using Microsoft.AspNetCore.Mvc;
using System;
using System.IO;
using System.Threading.Tasks;

[Route("api/[controller]")]
[ApiController]
public class WebhookController : ControllerBase
{
    [HttpPost]
    public async Task<IActionResult> Post()
    {
        try
        {
            var secret = Environment.GetEnvironmentVariable("WEBHOOK_SIGNATURE_SECRET");
            if (string.IsNullOrEmpty(secret))
            {
                return BadRequest(new { message = "Secret key is not configured." });
            }

            var header = Request.Headers["fpjs-event-signature"].ToString();
            if (string.IsNullOrEmpty(header))
            {
                return BadRequest(new { message = "Missing fpjs-event-signature header." });
            }

            using var memoryStream = new MemoryStream();
            await Request.Body.CopyToAsync(memoryStream);
            var data = memoryStream.ToArray();

            // Validate webhook signature
            var isValid = WebhookValidation.IsValidSignature(
                header,
                data,
                secret);

            if (!isValid)
            {
                return Forbid(new { message = "Webhook signature is invalid." });
            }

            // Process the webhook data here
            return Ok(new { message = "Webhook received." });
        }
        catch (Exception e)
        {
            return StatusCode(500, new { error = e.Message });
        }
    }
}

```

To learn more, refer to example located in [src/Fingerprint.ServerSdk.WebhookExample/Program.cs](src/Fingerprint.ServerSdk.WebhookExample/Program.cs).

<a name="documentation-for-api-endpoints"></a>
## Documentation for API Endpoints

All URIs are relative to *https://api.fpjs.io/v4*

Class | Method | HTTP request | Description
------------ | ------------- | ------------- | -------------
*FingerprintApi* | [**DeleteVisitorDataAsync**](docs/FingerprintApi.md#deletevisitordata) | **DELETE** /visitors/{visitor_id} | Delete data by visitor ID
*FingerprintApi* | [**GetEventAsync**](docs/FingerprintApi.md#getevent) | **GET** /events/{event_id} | Get an event by event ID
*FingerprintApi* | [**SearchEventsAsync**](docs/FingerprintApi.md#searchevents) | **GET** /events | Search events
*FingerprintApi* | [**UpdateEventAsync**](docs/FingerprintApi.md#updateevent) | **PATCH** /events/{event_id} | Update an event


<a name="documentation-for-models"></a>
## Documentation for Models

 - [Model.BotInfo](docs/models/BotInfo.md)
 - [Model.BotResult](docs/models/BotResult.md)
 - [Model.BrowserDetails](docs/models/BrowserDetails.md)
 - [Model.Canvas](docs/models/Canvas.md)
 - [Model.Emoji](docs/models/Emoji.md)
 - [Model.Error](docs/models/Error.md)
 - [Model.ErrorCode](docs/models/ErrorCode.md)
 - [Model.ErrorResponse](docs/models/ErrorResponse.md)
 - [Model.Event](docs/models/Event.md)
 - [Model.EventRuleAction](docs/models/EventRuleAction.md)
 - [Model.EventRuleActionAllow](docs/models/EventRuleActionAllow.md)
 - [Model.EventRuleActionBlock](docs/models/EventRuleActionBlock.md)
 - [Model.EventSearch](docs/models/EventSearch.md)
 - [Model.EventUpdate](docs/models/EventUpdate.md)
 - [Model.FontPreferences](docs/models/FontPreferences.md)
 - [Model.Geolocation](docs/models/Geolocation.md)
 - [Model.GeolocationSubdivisionsInner](docs/models/GeolocationSubdivisionsInner.md)
 - [Model.IPBlockList](docs/models/IPBlockList.md)
 - [Model.IPInfo](docs/models/IPInfo.md)
 - [Model.IPInfoV4](docs/models/IPInfoV4.md)
 - [Model.IPInfoV6](docs/models/IPInfoV6.md)
 - [Model.Identification](docs/models/Identification.md)
 - [Model.IdentificationConfidence](docs/models/IdentificationConfidence.md)
 - [Model.Integration](docs/models/Integration.md)
 - [Model.IntegrationSubintegration](docs/models/IntegrationSubintegration.md)
 - [Model.PluginsInner](docs/models/PluginsInner.md)
 - [Model.PluginsInnerMimeTypesInner](docs/models/PluginsInnerMimeTypesInner.md)
 - [Model.Proximity](docs/models/Proximity.md)
 - [Model.ProxyConfidence](docs/models/ProxyConfidence.md)
 - [Model.ProxyDetails](docs/models/ProxyDetails.md)
 - [Model.RawDeviceAttributes](docs/models/RawDeviceAttributes.md)
 - [Model.RequestHeaderModifications](docs/models/RequestHeaderModifications.md)
 - [Model.RuleActionHeaderField](docs/models/RuleActionHeaderField.md)
 - [Model.SDK](docs/models/SDK.md)
 - [Model.SearchEventsBot](docs/models/SearchEventsBot.md)
 - [Model.SearchEventsSdkPlatform](docs/models/SearchEventsSdkPlatform.md)
 - [Model.SearchEventsVpnConfidence](docs/models/SearchEventsVpnConfidence.md)
 - [Model.SupplementaryIDHighRecall](docs/models/SupplementaryIDHighRecall.md)
 - [Model.TamperingDetails](docs/models/TamperingDetails.md)
 - [Model.TouchSupport](docs/models/TouchSupport.md)
 - [Model.Velocity](docs/models/Velocity.md)
 - [Model.VelocityData](docs/models/VelocityData.md)
 - [Model.VpnConfidence](docs/models/VpnConfidence.md)
 - [Model.VpnMethods](docs/models/VpnMethods.md)
 - [Model.WebGlBasics](docs/models/WebGlBasics.md)
 - [Model.WebGlExtensions](docs/models/WebGlExtensions.md)


## Documentation for sealed results

- [Sealed](docs/models/Sealed.md)
- [DecryptionKey](docs/models/DecryptionKey.md)

## Documentation for webhooks

- [WebhookValidation](docs/models/WebhookValidation.md)

## Support and feedback

To report problems, ask questions or provide feedback, please use [Issues](https://github.com/fingerprintjs/dotnet-sdk/issues). If you need private support, you can email us at [oss-support@fingerprint.com](mailto:oss-support@fingerprint.com).

<a name="license"></a>
## License
This project is licensed under the [MIT license](https://github.com/fingerprintjs/dotnet-sdk/blob/main/LICENSE).
