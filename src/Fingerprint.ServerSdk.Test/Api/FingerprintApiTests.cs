/*
 * Server API
 *
 * Fingerprint (https://fingerprint.com) is a device intelligence platform offering industry-leading accuracy. Fingerprint Server API allows you to search, update, and delete identification events in a server environment. It can be used for data exports, decision-making, and data analysis scenarios. Server API is intended for server-side usage, it's not intended to be used from the client side, whether it's a browser or a mobile device.
 *
 * The version of the OpenAPI document: 4
 * Contact: support@fingerprint.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Net;
using System.Text.Json;
using System.Threading.Tasks;
using Xunit;
using Microsoft.Extensions.DependencyInjection;
using Fingerprint.ServerSdk.Api;
using Fingerprint.ServerSdk.Client;
using Fingerprint.ServerSdk.Model;


namespace Fingerprint.ServerSdk.Test.Api
{
    /// <summary>
    ///  Class for testing FingerprintApi
    /// </summary>
    public sealed class FingerprintApiTests : ApiTestsBase
    {
        private readonly IFingerprintApi _instance;

        public FingerprintApiTests() : base(Array.Empty<string>())
        {
            _instance = Host.Services.GetRequiredService<IFingerprintApi>();
        }

        /// <summary>
        /// Test DeleteVisitorData
        /// </summary>
        [Fact]
        public async Task DeleteVisitorDataAsyncTest()
        {
            const string visitorId = "AcxioeQKffpXF8iGQK3P";

            var response = await _instance.DeleteVisitorDataAsync(visitorId);
            Assert.Multiple(() =>
            {
                Assert.Single(Requests);
                Assert.Equal(HttpStatusCode.OK, response.StatusCode);

                var request = Requests.First().Request;
                Assert.Equal($"fingerprint-dotnet-sdk/{ClientUtils.ClientVersion}", request.Headers.Get("User-Agent"));
                Assert.Equal($"{ServerUrl}visitors/{visitorId}?ii=fingerprint-pro-server-api-dotnet-sdk%2f{ClientUtils.ClientVersion}", request.Url.ToString());
                Assert.Equal("DELETE", request.HttpMethod);
            });
        }

        [Fact]
        public async Task DeleteVisitorDataAsync403ErrorTest()
        {
            SetupMockResponse("errors/403_feature_not_enabled.json");
            MockResponseStatusCode = 403;

            const string visitorId = "AcxioeQKffpXF8iGQK3P";

            var response = await _instance.DeleteVisitorDataAsync(visitorId);
            Assert.Multiple(() =>
            {
                Assert.True(response.IsForbidden);
                var errorResponse = response.Forbidden();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.FeatureNotEnabled, errorResponse.Error.Code);
            });
        }

        [Fact]
        public async Task DeleteVisitorDataAsync400ErrorTest()
        {
            SetupMockResponse("errors/400_request_body_invalid.json");
            MockResponseStatusCode = 400;

            const string visitorId = "AcxioeQKffpXF8iGQK3P";

            var response = await _instance.DeleteVisitorDataAsync(visitorId);
            Assert.Multiple(() =>
            {
                Assert.True(response.IsBadRequest);
                var errorResponse = response.BadRequest();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.RequestCannotBeParsed, errorResponse.Error.Code);
            });
        }

        [Fact]
        public async Task DeleteVisitorDataAsync429ErrorTest()
        {
            SetupMockResponse("errors/429_too_many_requests.json");
            MockResponseStatusCode = 429;

            const string visitorId = "AcxioeQKffpXF8iGQK3P";

            var response = await _instance.DeleteVisitorDataAsync(visitorId);
            Assert.Multiple(() =>
            {
                Assert.True(response.IsTooManyRequests);
                var errorResponse = response.TooManyRequests();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.TooManyRequests, errorResponse.Error.Code);
            });
        }

        [Fact]
        public async Task DeleteVisitorDataAsync404ErrorTest()
        {
            SetupMockResponse("errors/404_visitor_not_found.json");
            MockResponseStatusCode = 404;

            const string visitorId = "AcxioeQKffpXF8iGQK3P";

            var response = await _instance.DeleteVisitorDataAsync(visitorId);
            Assert.Multiple(() =>
            {
                Assert.True(response.IsNotFound);
                var errorResponse = response.NotFound();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.VisitorNotFound, errorResponse.Error.Code);
            });
        }

        /// <summary>
        /// Test GetEvent
        /// </summary>
        [Fact]
        public async Task GetEventAsyncTest()
        {
            SetupMockResponse("events/get_event_200.json");

            const string eventId = "1708102555327.NLOjmg";
            var response = await _instance.GetEventAsync(eventId);

            Assert.Multiple(() =>
            {
                Assert.Single(Requests);
                Assert.Equal(HttpStatusCode.OK, response.StatusCode);

                var request = Requests.First().Request;
                Assert.Equal($"fingerprint-dotnet-sdk/{ClientUtils.ClientVersion}", request.Headers.Get("User-Agent"));
                Assert.Equal($"{ServerUrl}events/{eventId}?ii=fingerprint-pro-server-api-dotnet-sdk%2f{ClientUtils.ClientVersion}", request.Url.ToString());
                Assert.Equal("GET", request.HttpMethod);

                var model = response.Ok();
                Assert.IsType<Event>(model);
                Assert.Equal(eventId, model.EventId);
                Assert.Equal("94.142.239.124", model.IpInfo.V4.Address);
                Assert.False(model.ClonedApp);
                Assert.Equal(0, model.FactoryResetTimestamp);
                Assert.False(model.Frida);
                Assert.False(model.Incognito);
                Assert.False(model.IpBlocklist.TorNode);
                Assert.False(model.IpBlocklist.AttackSource);
                Assert.False(model.IpBlocklist.EmailSpam);
                Assert.False(model.Jailbroken);
                Assert.False(model.PrivacySettings);
                Assert.True(model.Proxy);
                Assert.Equal(ProxyDetails.ProxyTypeEnum.Residential, model.ProxyDetails.ProxyType);
                Assert.IsType<long>(model.ProxyDetails.LastSeenAt);
                Assert.False(model.RootApps);
                Assert.False(model.Tampering);
                Assert.False(model.VirtualMachine);
                Assert.False(model.Vpn);
                Assert.False(model.ClonedApp);
                Assert.IsType<long>(model.FactoryResetTimestamp);
                var factoryResetExpectedTime = DateTime.Parse("1970-01-01T00:00:00Z", CultureInfo.InvariantCulture,
                    DateTimeStyles.AdjustToUniversal);
                Assert.Equal(new DateTimeOffset(factoryResetExpectedTime).ToUnixTimeMilliseconds(), model.FactoryResetTimestamp);
            });

        }

        [Fact]
        public async Task SearchEventsAsyncTest()
        {
            SetupMockResponse("events/search/get_event_search_200.json");

            const int limit = 1;

            var response = await _instance.SearchEventsAsync(new SearchEventsRequest().WithLimit(limit));

            Assert.Multiple(() =>
            {
                Assert.Single(Requests);
                Assert.Equal(HttpStatusCode.OK, response.StatusCode);

                var request = Requests.First().Request;
                Assert.Equal($"fingerprint-dotnet-sdk/{ClientUtils.ClientVersion}", request.Headers.Get("User-Agent"));
                Assert.Equal($"{ServerUrl}events?ii=fingerprint-pro-server-api-dotnet-sdk%2f{ClientUtils.ClientVersion}&limit={limit}", request.Url.ToString());
                Assert.Equal("GET", request.HttpMethod);

                var eventSearch = response.Ok();
                Assert.IsType<EventSearch>(eventSearch);
                Assert.Single(eventSearch.Events);
                var firstEvent = eventSearch.Events.First();

                Assert.IsType<Event>(firstEvent);
                Assert.Equal("1708102555327.NLOjmg", firstEvent.EventId);
                Assert.Equal("94.142.239.124", firstEvent.IpInfo.V4.Address);
                Assert.False(firstEvent.ClonedApp);
                Assert.False(firstEvent.Emulator);
                Assert.Equal(0, firstEvent.FactoryResetTimestamp);
                Assert.False(firstEvent.Frida);
                Assert.False(firstEvent.Incognito);
                Assert.False(firstEvent.IpBlocklist.TorNode);
                Assert.False(firstEvent.IpBlocklist.AttackSource);
                Assert.False(firstEvent.IpBlocklist.EmailSpam);
                Assert.False(firstEvent.Jailbroken);
                Assert.False(firstEvent.PrivacySettings);
                Assert.True(firstEvent.Proxy);
                Assert.Equal(ProxyDetails.ProxyTypeEnum.Residential, firstEvent.ProxyDetails.ProxyType);
                Assert.IsType<long>(firstEvent.ProxyDetails.LastSeenAt);
                Assert.False(firstEvent.RootApps);
                Assert.False(firstEvent.Tampering);
                Assert.False(firstEvent.VirtualMachine);
                Assert.False(firstEvent.Vpn);
                Assert.False(firstEvent.ClonedApp);
                Assert.IsType<long>(firstEvent.FactoryResetTimestamp);
                var factoryResetExpectedTime = DateTime.Parse("1970-01-01T00:00:00Z", CultureInfo.InvariantCulture,
                    DateTimeStyles.AdjustToUniversal);
                Assert.Equal(new DateTimeOffset(factoryResetExpectedTime).ToUnixTimeMilliseconds(), firstEvent.FactoryResetTimestamp);
            });
        }

        /// <summary>
        /// Test SearchEvents
        /// </summary>
        [Fact]
        public async Task SearchEventsAsyncParamsTest()
        {
            SetupMockResponse("events/search/get_event_search_200.json");

            const int limit = 1;
            const string paginationKey = "pagination";
            const string visitorId = "AcxioeQKffpXF8iGQK3P";
            const SearchEventsBot bot = SearchEventsBot.Good;
            const string ipAddress = "10.0.0.0/24";
            const string asn = "asn";
            const string linkedId = "some_linked_id";
            const string url = "https://www.example.com/login?hope{this{works[!";
            const string origin = "com.foo.bar";
            const long start = 1582299576511;
            const long end = 1582299576513;
            const bool reverse = true;
            const bool suspect = false;
            const bool vpn = true;
            const bool virtualMachine = false;
            const bool tampering = false;
            const bool antiDetectBrowser = false;
            const bool incognito = false;
            const bool privacySettings = false;
            const bool jailbroken = false;
            const bool frida = false;
            const bool factoryReset = false;
            const bool clonedApp = false;
            const bool emulator = false;
            const bool rootApps = false;
            const SearchEventsVpnConfidence vpnConfidence = SearchEventsVpnConfidence.High;
            const float minSuspectScore = .7f;
            const bool developerTools = true;
            const bool locationSpoofing = true;
            const bool mitmAttack = true;
            const bool proxy = true;
            const string sdkVersion = "testSdkVersion";
            const SearchEventsSdkPlatform sdkPlatform = SearchEventsSdkPlatform.Js;
            var environment = new List<string> { "env1", "env2" };
            const string proximityId = "testProximityId";
            const long totalHits = 1;
            const bool torNode = false;

            var uriBuilder = new UriBuilder
            {
                Host = _instance.HttpClient.BaseAddress.Host,
                Port = _instance.HttpClient.BaseAddress.Port,
                Scheme = _instance.HttpClient.BaseAddress.Scheme,
                Path = _instance.HttpClient.BaseAddress.AbsolutePath == "/"
                    ? "/events"
                    : string.Concat(_instance.HttpClient.BaseAddress.AbsolutePath, "/events")
            };
            var parseQueryString = System.Web.HttpUtility.ParseQueryString(string.Empty);
            parseQueryString["ii"] = $"fingerprint-pro-server-api-dotnet-sdk/{ClientUtils.ClientVersion}";
            parseQueryString["limit"] = ClientUtils.ParameterToString(limit);
            parseQueryString["pagination_key"] = ClientUtils.ParameterToString(paginationKey);
            parseQueryString["visitor_id"] = ClientUtils.ParameterToString(visitorId);
            parseQueryString["bot"] = ClientUtils.ParameterToString(bot);
            parseQueryString["ip_address"] = ClientUtils.ParameterToString(ipAddress);
            parseQueryString["asn"] = ClientUtils.ParameterToString(asn);
            parseQueryString["linked_id"] = ClientUtils.ParameterToString(linkedId);
            parseQueryString["url"] = ClientUtils.ParameterToString(url);
            parseQueryString["origin"] = ClientUtils.ParameterToString(origin);
            parseQueryString["start"] = ClientUtils.ParameterToString(start);
            parseQueryString["end"] = ClientUtils.ParameterToString(end);
            parseQueryString["reverse"] = ClientUtils.ParameterToString(reverse);
            parseQueryString["suspect"] = ClientUtils.ParameterToString(suspect);
            parseQueryString["vpn"] = ClientUtils.ParameterToString(vpn);
            parseQueryString["virtual_machine"] = ClientUtils.ParameterToString(virtualMachine);
            parseQueryString["tampering"] = ClientUtils.ParameterToString(tampering);
            parseQueryString["anti_detect_browser"] = ClientUtils.ParameterToString(antiDetectBrowser);
            parseQueryString["incognito"] = ClientUtils.ParameterToString(incognito);
            parseQueryString["privacy_settings"] = ClientUtils.ParameterToString(privacySettings);
            parseQueryString["jailbroken"] = ClientUtils.ParameterToString(jailbroken);
            parseQueryString["frida"] = ClientUtils.ParameterToString(frida);
            parseQueryString["factory_reset"] = ClientUtils.ParameterToString(factoryReset);
            parseQueryString["cloned_app"] = ClientUtils.ParameterToString(clonedApp);
            parseQueryString["emulator"] = ClientUtils.ParameterToString(emulator);
            parseQueryString["root_apps"] = ClientUtils.ParameterToString(rootApps);
            parseQueryString["vpn_confidence"] = ClientUtils.ParameterToString(vpnConfidence);
            parseQueryString["min_suspect_score"] = ClientUtils.ParameterToString(minSuspectScore);
            parseQueryString["developer_tools"] = ClientUtils.ParameterToString(developerTools);
            parseQueryString["location_spoofing"] = ClientUtils.ParameterToString(locationSpoofing);
            parseQueryString["mitm_attack"] = ClientUtils.ParameterToString(mitmAttack);
            parseQueryString["proxy"] = ClientUtils.ParameterToString(proxy);
            parseQueryString["sdk_version"] = ClientUtils.ParameterToString(sdkVersion);
            parseQueryString["sdk_platform"] = ClientUtils.ParameterToString(sdkPlatform);
            parseQueryString["environment"] = ClientUtils.ParameterToString(environment);
            parseQueryString["proximity_id"] = ClientUtils.ParameterToString(proximityId);
            parseQueryString["total_hits"] = ClientUtils.ParameterToString(totalHits);
            parseQueryString["tor_node"] = ClientUtils.ParameterToString(torNode);
            uriBuilder.Query = parseQueryString.ToString();

            var response = await _instance.SearchEventsAsync(new SearchEventsRequest()
                .WithLimit(limit)
                .WithPaginationKey(paginationKey)
                .WithVisitorId(visitorId)
                .WithBot(bot)
                .WithIpAddress(ipAddress)
                .WithAsn(asn)
                .WithLinkedId(linkedId)
                .WithUrl(url)
                .WithOrigin(origin)
                .WithStart(start)
                .WithEnd(end)
                .WithReverse(reverse)
                .WithSuspect(suspect)
                .WithVpn(vpn)
                .WithVirtualMachine(virtualMachine)
                .WithTampering(tampering)
                .WithAntiDetectBrowser(antiDetectBrowser)
                .WithIncognito(incognito)
                .WithPrivacySettings(privacySettings)
                .WithJailbroken(jailbroken)
                .WithFrida(frida)
                .WithFactoryReset(factoryReset)
                .WithClonedApp(clonedApp)
                .WithEmulator(emulator)
                .WithRootApps(rootApps)
                .WithVpnConfidence(vpnConfidence)
                .WithMinSuspectScore(minSuspectScore)
                .WithDeveloperTools(developerTools)
                .WithLocationSpoofing(locationSpoofing)
                .WithMitmAttack(mitmAttack)
                .WithProxy(proxy)
                .WithSdkVersion(sdkVersion)
                .WithSdkPlatform(sdkPlatform)
                .WithEnvironment(environment)
                .WithProximityId(proximityId)
                .WithTotalHits(totalHits)
                .WithTorNode(torNode));

            Assert.Multiple(() =>
            {
                Assert.Single(Requests);
                Assert.Equal(HttpStatusCode.OK, response.StatusCode);

                var request = Requests.First().Request;
                Assert.Equal($"fingerprint-dotnet-sdk/{ClientUtils.ClientVersion}", request.Headers.Get("User-Agent"));

                Assert.Equal(uriBuilder.Uri.ToString(), request.Url.ToString());
                Assert.Equal("GET", request.HttpMethod);

                var eventSearch = response.Ok();
                Assert.IsType<EventSearch>(eventSearch);
                Assert.Single(eventSearch.Events);
                var firstEvent = eventSearch.Events.First();

                Assert.IsType<Event>(firstEvent);
                Assert.Equal("1708102555327.NLOjmg", firstEvent.EventId);
                Assert.Equal("94.142.239.124", firstEvent.IpInfo.V4.Address);
                Assert.False(firstEvent.ClonedApp);
                Assert.False(firstEvent.Emulator);
                Assert.Equal(0, firstEvent.FactoryResetTimestamp);
                Assert.False(firstEvent.Frida);
                Assert.False(firstEvent.Incognito);
                Assert.False(firstEvent.IpBlocklist.TorNode);
                Assert.False(firstEvent.IpBlocklist.AttackSource);
                Assert.False(firstEvent.IpBlocklist.EmailSpam);
                Assert.False(firstEvent.Jailbroken);
                Assert.False(firstEvent.PrivacySettings);
                Assert.True(firstEvent.Proxy);
                Assert.Equal(ProxyDetails.ProxyTypeEnum.Residential, firstEvent.ProxyDetails.ProxyType);
                Assert.IsType<long>(firstEvent.ProxyDetails.LastSeenAt);
                Assert.False(firstEvent.RootApps);
                Assert.False(firstEvent.Tampering);
                Assert.False(firstEvent.VirtualMachine);
                Assert.False(firstEvent.Vpn);
                Assert.False(firstEvent.ClonedApp);
                Assert.IsType<long>(firstEvent.FactoryResetTimestamp);
                var factoryResetExpectedTime = DateTime.Parse("1970-01-01T00:00:00Z", CultureInfo.InvariantCulture,
                    DateTimeStyles.AdjustToUniversal);
                Assert.Equal(new DateTimeOffset(factoryResetExpectedTime).ToUnixTimeMilliseconds(), firstEvent.FactoryResetTimestamp);
            });
        }

        [Fact]
        public async Task SearchEventsAsync400ErrorTest()
        {
            SetupMockResponse("errors/400_request_body_invalid.json");
            MockResponseStatusCode = 400;

            const int limit = 1;
            const string ipAddress = "01234";

            var response = await _instance.SearchEventsAsync(new SearchEventsRequest()
                .WithLimit(limit)
                .WithIpAddress(ipAddress));
            Assert.Multiple(() =>
            {
                Assert.True(response.IsBadRequest);
                var errorResponse = response.BadRequest();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.RequestCannotBeParsed, errorResponse.Error.Code);
            });
        }

        [Fact]
        public async Task SearchEventsAsync403ErrorTest()
        {
            SetupMockResponse("errors/403_feature_not_enabled.json");
            MockResponseStatusCode = 403;

            const int limit = 1;

            var response = await _instance.SearchEventsAsync(new SearchEventsRequest().WithLimit(limit));
            Assert.Multiple(() =>
            {
                Assert.True(response.IsForbidden);
                var errorResponse = response.Forbidden();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.FeatureNotEnabled, errorResponse.Error.Code);
            });
        }

        /// <summary>
        /// Test UpdateEvent
        /// </summary>
        [Fact]
        public async Task UpdateEventAsyncTest()
        {
            const string eventId = "1708102555327.NLOjmg";
            var eventUpdate = new EventUpdate
            {
                Suspect = false,
                LinkedId = "new_linked_id",
                Tags = new Dictionary<string, object>
                {
                    { "foo", "bar" },
                    { "baz", true }
                }
            };

            var response = await _instance.UpdateEventAsync(eventId, eventUpdate);
            Assert.Multiple(() =>
            {
                Assert.Single(Requests);
                Assert.Equal(HttpStatusCode.OK, response.StatusCode);

                var firstRequest = Requests.First();
                var request = firstRequest.Request;
                var body = firstRequest.Body;

                Assert.Equal($"fingerprint-dotnet-sdk/{ClientUtils.ClientVersion}", request.Headers.Get("User-Agent"));
                Assert.Equal($"{ServerUrl}events/{eventId}?ii=fingerprint-pro-server-api-dotnet-sdk%2f{ClientUtils.ClientVersion}", request.Url.ToString());
                Assert.Equal("PATCH", request.HttpMethod);
                Assert.Equal("application/json", request.ContentType);
                Assert.Equal(JsonSerializer.Serialize(eventUpdate, Host.Services.GetService<JsonSerializerOptions>()), body);
            });
        }

        /// <summary>
        /// </summary>
        [Fact]
        public async Task UpdateEventAsync400ErrorTest()
        {
            SetupMockResponse("errors/400_request_body_invalid.json");
            MockResponseStatusCode = 400;

            const string eventId = "1708102555327.NLOjmg";
            var eventUpdate = new EventUpdate
            {
                Suspect = false,
                LinkedId = "new_linked_id",
                Tags = new Dictionary<string, object>
                {
                    { "foo", "bar" },
                    { "baz", true }
                }
            };

            var response = await _instance.UpdateEventAsync(eventId, eventUpdate);
            Assert.Multiple(() =>
            {
                Assert.True(response.IsBadRequest);
                var errorResponse = response.BadRequest();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.RequestCannotBeParsed, errorResponse.Error.Code);
            });
        }

        /// <summary>
        /// </summary>
        [Fact]
        public async Task UpdateEventAsync403ErrorTest()
        {
            SetupMockResponse("errors/403_feature_not_enabled.json");
            MockResponseStatusCode = 403;

            const string eventId = "1708102555327.NLOjmg";
            var eventUpdate = new EventUpdate
            {
                Suspect = false,
                LinkedId = "new_linked_id",
                Tags = new Dictionary<string, object>
                {
                    { "foo", "bar" },
                    { "baz", true }
                }
            };

            var response = await _instance.UpdateEventAsync(eventId, eventUpdate);
            Assert.Multiple(() =>
            {
                Assert.True(response.IsForbidden);
                var errorResponse = response.Forbidden();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.FeatureNotEnabled, errorResponse.Error.Code);
            });
        }

        /// <summary>
        /// </summary>
        [Fact]
        public async Task UpdateEventAsync404ErrorTest()
        {
            SetupMockResponse("errors/404_event_not_found.json");
            MockResponseStatusCode = 404;

            const string eventId = "1708102555327.NLOjmg";
            var eventUpdate = new EventUpdate
            {
                Suspect = false,
                LinkedId = "new_linked_id",
                Tags = new Dictionary<string, object>
                {
                    { "foo", "bar" },
                    { "baz", true }
                }
            };

            var response = await _instance.UpdateEventAsync(eventId, eventUpdate);
            Assert.Multiple(() =>
            {
                Assert.True(response.IsNotFound);
                var errorResponse = response.NotFound();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.EventNotFound, errorResponse.Error.Code);
            });
        }

        /// <summary>
        /// </summary>
        [Fact]
        public async Task UpdateEventAsync409ErrorTest()
        {
            SetupMockResponse("errors/409_state_not_ready.json");
            MockResponseStatusCode = 409;

            const string eventId = "1708102555327.NLOjmg";
            var eventUpdate = new EventUpdate
            {
                Suspect = false,
                LinkedId = "new_linked_id",
                Tags = new Dictionary<string, object>
                {
                    { "foo", "bar" },
                    { "baz", true }
                }
            };

            var response = await _instance.UpdateEventAsync(eventId, eventUpdate);
            Assert.Multiple(() =>
            {
                Assert.True(response.IsConflict);
                var errorResponse = response.Conflict();
                Assert.IsType<ErrorResponse>(errorResponse);
                Assert.Equal(ErrorCode.StateNotReady, errorResponse.Error.Code);
            });
        }
    }
}